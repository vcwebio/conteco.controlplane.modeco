#!/usr/bin/env bash
if [[ "$1" == "for-each-node" ]] ; then
(
	shift
    . executionplane-invoke "$0 $@"
	imageName="${CONTECO_REALM}/${CONTECO_ECOSYSTEM}.${CONTECO_TYPE}.${CONTECO_NAME}"
	.base repo $@
    executionplane-complete
)
else
    export PATH="$CONTECO_EXECUTIONPLANE_APIINTERNALPATH_MODECO"
	selector=$(set-selector "${BASH_ARGV[0]}")
	echo $selector
	. check-selector-exists $selector "$1"
	if [[ "$CONTECO_STATE" == "virtual" ]] ; then
		$(basename $0) "for-each-node" ${@:1:$#-1} $selector
	else
		for-each $(basename $0) $@
	fi
fi
