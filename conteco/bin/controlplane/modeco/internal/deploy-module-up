#!/usr/bin/env bash
rootPath=$1

# create module overlay network
executionplane --silent docker network create -d overlay ${CONTECO_TYPE}_overlay

# create initialised module volumes on all nodes
volumePrefix=$(echo "${CONTECO_TYPE}" | tr '.-' '_')
IFS=',' read -r -a volumes <<< "${CONTECO_DC_GLOBAL_VOLUME_LIST}"
for volume in ${volumes[@]};
do
	controlplane-service docker volume create "${volumePrefix}_${volume}"
done;

IFS=',' read -r -a volumes <<< "${CONTECO_DC_GLOBAL_VOLUME_INITIALISED}"
for volumeSettings in ${volumes[@]};
do
	volumeName=$(echo $volumeSettings | cut -d':' -f 1)
	volumeDir=$(echo $volumeSettings | cut -d':' -f 2)
	controlplane-service docker run -v ${volumePrefix}_${volumeName}:${volumeDir} ${CONTECO_REGISTRY}${CONTECO_REALM_RUNTIME}/${CONTECO_ECOSYSTEM_RUNTIME}.${CONTECO_TYPE}.${CONTECO_NAME} --interactive tar -C / -xvf /modeco/volumes/${volumeName}.tar
done;
