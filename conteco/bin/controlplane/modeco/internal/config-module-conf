#!/usr/bin/env bash
(
	rootPath=$1

	# initial step to copy full stack and settings.base from CONTECO_MODECO_BASE
	# settings remains untouched
  destination="$rootPath/modeco"
	source="${CONTECO_PWD}/${CONTECO_REALM}/modeco.base.${CONTECO_MODECO_BASE}/modeco"
	cp $source/settings $destination/settings.base
	cp $source/stacks/*.yml $destination/stacks

	# next rename / clone the (allowed and) required stacks

#	IFS=',' read -r -a stacks <<< "${CONTECO_DC_GLOBAL_STACKS}"
#	IFS=',' read -r -a stackNames <<< "${CONTECO_DC_GLOBAL_STACKNAMES}"
#	CONTECO_TYPE_ENV=$(echo "${CONTECO_TYPE^^}" | tr - _)
#	cp $rootPath/modeco/settings.template $rootPath/modeco/settings.module
#	for stackNumber in ${!stacks[@]};
#	do
#		STACKNAME_ENV=$(echo "${stackNames[stackNumber]^^}" | tr - _)
#		source=$rootPath/modeco/stacks/${stackNumber}.${stacks[stackNumber]}.docker-compose.yml.template
#		destination=$rootPath/modeco/stacks/${stackNames[stackNumber]}.docker-compose.yml
#		cat $source | envsubst '${CONTECO_TYPE}' > $destination
#		sed -i -e "s/CONTECO_DC_${stackNumber}_/${STACKNAME_ENV}_/g" $destination
#		sed -i -e "s/CONTECO_DC_${stackNumber}_/${STACKNAME_ENV}_/g" $rootPath/modeco/settings.module
#		done;
#		sed -i -e "s/CONTECO_DC_/${CONTECO_TYPE_ENV}_/g" $rootPath/modeco/settings.module
#
#		for stackName in ${stackNames[@]};
#		do
#			destination=$rootPath/modeco/stacks/${stackName}.docker-compose.yml
#			for stackNumber in ${!stacks[@]};
#			do
#				STACKNAME_ENV=$(echo "${stackNames[stackNumber]}" | tr - _)
#				sed -i -e "s/CONTECO_DC_${stackNumber}_/${STACKNAME_ENV}_/g" $destination
#			done;
#			sed -i -e "s/CONTECO_DC_/${CONTECO_TYPE_ENV}_/g" $destination
#		done;
#	fi
)
